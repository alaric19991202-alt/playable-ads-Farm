@import url("https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&display=swap");

:root{
  --safeB: env(safe-area-inset-bottom, 0px);
  --safeT: env(safe-area-inset-top, 0px);

  /* Garden Joy-ish palette */
  --ui: rgba(255,255,255,0.92);
  --ui2: rgba(255,255,255,0.86);
  --stroke: rgba(18, 32, 48, 0.10);
  --text: #183044;
  --muted: rgba(24,48,68,0.70);
  --shadow: 0 14px 28px rgba(0,0,0,0.14);

  --teal: #2bb5b0;      /* required */
  --pink: #ff6fae;      /* bonus */
  --green: #34c76a;     /* finish */
  --gold: #ffcf5a;

  --radius: 18px;
  --pill: 999px;

  --font: "Outfit", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
}

html, body{
  width:100%; height:100%; margin:0;
  font-family: var(--font);
  color: var(--text);
  /* Allow UI scrolling (bottom carousel) on mobile; the 3D canvas blocks gestures itself. */
  touch-action: manipulation;
  overscroll-behavior: none;
}

body{
  background:
    radial-gradient(900px 600px at 15% 0%, rgba(70, 214, 255, 0.30), transparent 60%),
    radial-gradient(900px 800px at 85% 100%, rgba(255, 166, 210, 0.24), transparent 65%),
    linear-gradient(180deg, #e8fbff 0%, #d7f6ff 35%, #eaf9ef 100%);
}

body.night{
  background:
    radial-gradient(900px 600px at 15% 0%, rgba(120, 160, 255, 0.20), transparent 60%),
    radial-gradient(900px 800px at 85% 100%, rgba(255, 166, 210, 0.12), transparent 65%),
    linear-gradient(180deg, #0b1930 0%, #071425 40%, #04101c 100%);
  --ui: rgba(255,255,255,0.08);
  --ui2: rgba(255,255,255,0.10);
  --stroke: rgba(255,255,255,0.12);
  --text: #f3f7ff;
  --muted: rgba(243,247,255,0.75);
  --shadow: 0 18px 34px rgba(0,0,0,0.45);
}

#app{ position:relative; width:100%; height:100%; overflow:hidden; perspective: 1200px; perspective-origin: 50% 100%; }
#c{ width:100%; height:100%; display:block; touch-action: none; }

/* Loading */
.loading{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; z-index:10; background: rgba(0,0,0,0.18); backdrop-filter: blur(10px); }
.loadingCard{ width:min(440px, calc(100% - 28px)); padding:18px 18px 16px; border-radius: var(--radius); background: var(--ui); border: 1px solid var(--stroke); box-shadow: var(--shadow); }
.loadingTitle{ font-weight: 800; font-size: 18px; }
.loadingSub{ margin-top: 2px; color: var(--muted); font-size: 13px; }
.loadingBar{ margin-top: 12px; width:100%; height:10px; background: rgba(0,0,0,0.08); border-radius: var(--pill); overflow:hidden; }
.loadingBarFill{ width:0%; height:100%; border-radius: var(--pill); background: linear-gradient(90deg, var(--teal), var(--pink)); }
.loadingText{ margin-top:10px; font-size: 13px; color: var(--muted); }

/* HUD */
#hud{ position:absolute; inset:0; pointer-events:none; z-index:5; }
.brandDot{
  width: 45px; height: 45px;
  border-radius: 20%;
  background: linear-gradient(135deg, var(--accent), var(--accent-2));
  box-shadow: 0 0 0 4px rgba(95,231,178,0.18), 0 0 16px rgba(95,231,178,0.35);
}
.topBar{
  pointer-events:auto;
  position:absolute;
  left: 12px; right: 12px;
  top: calc(10px + var(--safeT));
  display:flex; align-items:center; gap: 10px;
}

.iconBtn{
  width: 44px; height: 44px;
  border-radius: 14px;
  border: 1px solid var(--stroke);
  background: var(--ui);
  box-shadow: var(--shadow);
  font-size: 18px;
  display:flex; align-items:center; justify-content:center;
  cursor:pointer;
}

.leftToggleIcon{
  width: 12px;
  height: 12px;
  display:block;
  position:relative;
}
.leftToggleIcon::before{
  content:"";
  position:absolute;
  inset: 1px;
  border-right: 2px solid currentColor;
  border-bottom: 2px solid currentColor;
  transform: rotate(135deg);
  transition: transform 200ms ease;
}
.leftToggle.collapsed .leftToggleIcon::before{
  transform: rotate(-45deg);
}

.challengeCard{
  flex: 1;
  min-width: 0;
  padding: 10px 12px;
  border-radius: var(--radius);
  background: var(--ui);
  border: 1px solid var(--stroke);
  box-shadow: var(--shadow);
}
.challengeTitle{ font-weight: 800; font-size: 20px; white-space: nowrap; overflow:hidden; text-overflow: ellipsis; }
.challengeSub{ margin-top: 1px; color: var(--muted); font-size: 12px; white-space: nowrap; overflow:hidden; text-overflow: ellipsis; }

.topRight{ display:flex; align-items:center; gap: 10px; }
.currencyRow{ display:flex; gap: 8px; }

.pill{
  display:flex; align-items:center; gap: 6px;
  padding: 8px 10px;
  border-radius: var(--pill);
  background: var(--ui);
  border: 1px solid var(--stroke);
  box-shadow: var(--shadow);
  font-weight: 800;
  font-variant-numeric: tabular-nums;
}
.pillIcon{ width: 18px; height: 18px; }
.pillEmoji{ font-size: 16px; line-height: 1; }
.pillValue{ font-size: 14px; }

.hint{
  pointer-events:none;
  position:absolute;
  left: 50%;
  transform: translateX(-50%);
  top: calc(75px + var(--safeT));
  padding: 8px 12px;
  border-radius: var(--pill);
  background: rgba(255,255,255,0.90);
  border: 1px solid rgba(0,0,0,0.08);
  box-shadow: 0 10px 18px rgba(0,0,0,0.12);
  color: #20364d;
  font-weight: 700;
  font-size: 13px;
  opacity: 0;
  transition: opacity 180ms ease;
}
body.night .hint{ background: rgba(0,0,0,0.42); border-color: rgba(255,255,255,0.16); color: rgba(255,255,255,0.92); }
.hint.show{ opacity: 1; }

/* Left tasks */
.leftPanel{
  pointer-events:auto;
  position:absolute;
  left: 12px;
  top: calc(120px + var(--safeT));
  width: 156px;
  max-width: 42vw;
  max-height: calc(100% - 220px);
  overflow: auto;
  padding: 12px;
  border-radius: var(--radius);
  background: var(--ui);
  border: 1px solid var(--stroke);
  box-shadow: var(--shadow);
  transform: translateX(0);
  transform-origin: 0 50%;
  transition: transform 260ms ease, opacity 200ms ease;
  will-change: transform, opacity;
}
.leftPanel.collapsed{
  transform: translateX(calc(-100% - 18px)) rotateY(35deg);
  opacity: 0;
  pointer-events:none;
}
.taskHeader{ font-weight: 800; font-size: 13px; margin-bottom: 8px; }
.taskHeader.optional{ margin-top: 10px; color: var(--pink); }
.taskList{ display:flex; flex-direction:column; gap: 8px; }
.taskRow{
  display:flex; align-items:center; justify-content:space-between; gap: 8px;
  padding: 8px 10px;
  border-radius: 14px;
  border: 1px solid rgba(0,0,0,0.08);
  background: rgba(255,255,255,0.72);
}
body.night .taskRow{ background: rgba(255,255,255,0.08); border-color: rgba(255,255,255,0.14); }
.taskLeft{ display:flex; align-items:center; gap: 8px; min-width:0; }
.taskDot{
  width: 12px; height: 12px; border-radius: 999px;
  background: var(--teal);
  box-shadow: 0 0 0 4px rgba(43,181,176,0.18);
}
.taskDot.bonus{ background: var(--pink); box-shadow: 0 0 0 4px rgba(255,111,174,0.18); }
.taskLabel{ font-weight: 800; font-size: 12px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.taskCheck{ font-weight: 900; font-size: 14px; opacity: 0.4; }
.taskRow.done .taskCheck{ opacity: 1; color: var(--green); }

.leftActions{ margin-top: 12px; display:flex; justify-content:flex-start; }
.pillBtn{
  width: 100%;
  height: 38px;
  border-radius: var(--pill);
  border: 1px solid var(--stroke);
  background: rgba(0,0,0,0.04);
  color: var(--text);
  font-weight: 900;
  cursor:pointer;
}
body.night .pillBtn{ background: rgba(255,255,255,0.10); }
.pillBtn:disabled{ opacity: 0.5; cursor:not-allowed; }

/* Bottom bar */
.bottomBar{
  pointer-events:auto;
  position:absolute;
  left: 12px; right: 12px;
  bottom: calc(10px + var(--safeB));
  display:flex;
  flex-direction:column;
  gap: 10px;
  padding: 10px 12px 12px;
  border-radius: calc(var(--radius) + 6px);
  background: linear-gradient(180deg, rgba(255,255,255,0.96), rgba(255,255,255,0.86));
  border: 1px solid rgba(255,255,255,0.6);
  box-shadow: 0 18px 32px rgba(5, 22, 38, 0.16);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  overflow:hidden;
}
body.night .bottomBar{
  background: linear-gradient(180deg, rgba(16, 28, 44, 0.82), rgba(8, 18, 30, 0.45));
  border-color: rgba(255, 255, 255, 0.32);
  box-shadow: 0 24px 40px rgba(0,0,0,0.45);
}
.bottomBar.collapsed{ padding-bottom: 8px; }

.bottomBarTop{
  display:flex;
  align-items:center;
  justify-content:flex-end;
  gap: 8px;
  flex-wrap: wrap;
}

.bottomBarBody{
  display:grid;
  grid-template-columns: 64px minmax(0, 1fr);
  align-items:start;
  gap: 12px;
  padding: 0 2px 2px;
  max-height: 38vh;
  transform-origin: top;
  transition: max-height 280ms ease, opacity 200ms ease, transform 260ms ease;
}
.bottomBar.collapsed .bottomBarBody{
  max-height: 0;
  opacity: 0;
  transform: rotateX(-12deg) translateY(8px);
  pointer-events:none;
}
.requireBtn{
  height: 34px;
  padding: 0 12px;
  border-radius: 12px;
  border: 1px solid rgba(0, 0, 0, 0.12);
  background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(240,245,250,0.92));
  color: var(--text);
  font-weight: 900;
  font-size: 12px;
  letter-spacing: 0.2px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap: 6px;
  box-shadow: 0 6px 12px rgba(12, 26, 42, 0.18);
  cursor:pointer;
  white-space: nowrap;
}
body.night .requireBtn{
  background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.06));
  border-color: rgba(255,255,255,0.14);
  color: var(--text);
}
.panelBtn{
  height: 34px;
  padding: 0 12px;
  border-radius: 12px;
  border: 1px solid rgba(0, 0, 0, 0.12);
  background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(240,245,250,0.92));
  color: var(--text);
  font-weight: 900;
  font-size: 12px;
  letter-spacing: 0.2px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap: 6px;
  box-shadow: 0 6px 12px rgba(12, 26, 42, 0.18);
  cursor:pointer;
  white-space: nowrap;
}
body.night .panelBtn{
  background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.06));
  border-color: rgba(255,255,255,0.14);
  color: var(--text);
}
.panelBtn:disabled{ opacity: 0.55; cursor:not-allowed; }

.panelToggle{ width: 32px; padding: 0; }
.panelToggleIcon{
  width: 12px;
  height: 12px;
  display:inline-block;
  position:relative;
}
.panelToggleIcon::before{
  content:"";
  position:absolute;
  inset: 1px;
  border-right: 2px solid currentColor;
  border-bottom: 2px solid currentColor;
  transform: rotate(45deg);
  transition: transform 200ms ease;
}
.bottomBar.collapsed .panelToggleIcon::before{
  transform: rotate(-135deg);
}

.categoryTabs{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap: 8px;
  padding: 8px;
  border-radius: 16px;
  background: rgba(255,255,255,0.7);
  border: 1px solid rgba(0,0,0,0.06);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.9);
}
body.night .categoryTabs{
  background: rgba(255,255,255,0.08);
  border-color: rgba(255,255,255,0.12);
}
.categoryTab{
  width: 42px; height: 42px;
  border-radius: 14px;
  border: 1px solid transparent;
  background: linear-gradient(160deg, rgba(255,255,255,0.9), rgba(238,246,252,0.9));
  display:flex; align-items:center; justify-content:center;
  font-size: 18px;
  cursor:pointer;
  transition: transform 140ms ease, box-shadow 140ms ease, border-color 140ms ease;
}
body.night .categoryTab{
  background: rgba(255,255,255,0.10);
  border-color: rgba(255,255,255,0.10);
}
.categoryTab:hover{ transform: translateY(-1px); }
.categoryTab.selected{
  background: linear-gradient(135deg, #2bb5b0, #2ac08b);
  color: #ffffff;
  border-color: rgba(255,255,255,0.6);
  box-shadow: 0 10px 18px rgba(43,181,176,0.32);
  transform: translateY(-2px);
}
body.night .categoryTab.selected{
  background: linear-gradient(135deg, #2bb5b0, #3cd6a1);
  box-shadow: 0 12px 22px rgba(0,0,0,0.35);
}

.itemCarousel{
  min-width: 0;
  display:flex;
  gap: 12px;
  overflow-x: auto;
  padding: 6px 4px;
  width: 100%;
  align-self: stretch;
  scroll-snap-type: x proximity;
  -webkit-overflow-scrolling: touch;
  touch-action: pan-x;
}
.itemCarousel::-webkit-scrollbar{ height: 6px; }
.itemCarousel::-webkit-scrollbar-thumb{ background: rgba(0,0,0,0.14); border-radius: var(--pill); }

.itemCard{
  flex: 0 0 auto;
  width: 118px;
  scroll-snap-align: start;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,0.7);
  background: linear-gradient(160deg, rgba(255,255,255,0.95), rgba(245,251,255,0.86));
  box-shadow: 0 12px 22px rgba(13, 30, 50, 0.14);
  padding: 10px 10px 12px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap: 6px;
  cursor:pointer;
  transition: transform 160ms ease, box-shadow 160ms ease, border-color 160ms ease;
}
body.night .itemCard{
  background: rgba(255,255,255,0.08);
  border-color: rgba(255,255,255,0.12);
  box-shadow: 0 12px 22px rgba(0,0,0,0.35);
}
.itemCard:hover{ transform: translateY(-2px); }
.itemCard:active{ transform: translateY(0); }
.itemCard.selected{
  border-color: rgba(255,111,174,0.65);
  box-shadow: 0 16px 26px rgba(255,111,174,0.25);
  transform: translateY(-3px);
}
.itemThumb{
  width: 54px; height: 54px;
  border-radius: 14px;
  object-fit: cover;
  background: radial-gradient(circle at 30% 20%, rgba(255,255,255,0.9), rgba(214,232,245,0.8));
  box-shadow: inset 0 1px 2px rgba(0,0,0,0.08);
}
.itemName{ font-weight: 900; font-size: 12px; text-align:center; line-height: 1.1; }
.pricePill{
  display:flex; align-items:center; gap: 6px;
  padding: 6px 10px;
  border-radius: var(--pill);
  border: 1px solid rgba(0,0,0,0.06);
  background: rgba(255,255,255,0.8);
  font-weight: 900;
  font-size: 12px;
}
body.night .pricePill{ background: rgba(255,255,255,0.10); border-color: rgba(255,255,255,0.14); }
.finishBtn{
  flex: 0 0 auto;
  height: 34px;
  padding: 0 14px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.6);
  background: linear-gradient(180deg, #3cd476, #17a954);
  color: white;
  font-weight: 900;
  font-size: 12px;
  cursor:pointer;
  box-shadow: 0 16px 26px rgba(23, 169, 84, 0.35);
  transition: transform 160ms ease, box-shadow 160ms ease;
}
.finishBtn:active{ transform: translateY(1px); }
body.night .finishBtn{ border-color: rgba(255,255,255,0.22); }
.finishBtn:disabled{ opacity: 0.45; filter: grayscale(0.2); cursor:not-allowed; box-shadow:none; }
.finishBtn.pulse{ animation: pulse 1s ease-in-out infinite; }
@keyframes pulse{ 0%{ transform: scale(1);} 50%{ transform: scale(1.05);} 100%{ transform: scale(1);} }

/* Tutorial overlay */
.tutorial{
  pointer-events:auto;
  position:absolute; inset:0;
  display:flex; align-items:flex-end; justify-content:center;
  padding: 0 14px calc(90px + var(--safeB));
  background: rgba(0,0,0,0.25);
  backdrop-filter: blur(6px);
}
.tutorial.hidden{ display:none; }
.tutorialCard{
  width:min(520px, 100%);
  border-radius: var(--radius);
  background: var(--ui);
  border: 1px solid var(--stroke);
  box-shadow: var(--shadow);
  padding: 12px;
  display:flex; align-items:center; justify-content:space-between; gap: 10px;
}
.tutorialText{ font-weight: 800; font-size: 13px; color: var(--text); }
.btnOk{
  height: 38px;
  padding: 0 14px;
  border-radius: var(--pill);
  border: 1px solid rgba(0,0,0,0.08);
  background: linear-gradient(180deg, var(--teal), #1aa7a2);
  color: white;
  font-weight: 900;
  cursor:pointer;
}

/* Modal */
.modal{
  pointer-events:auto;
  position:absolute; inset:0;
  display:flex; align-items:center; justify-content:center;
  background: rgba(0,0,0,0.35);
  backdrop-filter: blur(10px);
  z-index: 9;
}
.modal.hidden{ display:none; }
.modalCard{
  width:min(520px, calc(100% - 28px));
  border-radius: calc(var(--radius) + 6px);
  background: var(--ui);
  border: 1px solid var(--stroke);
  box-shadow: var(--shadow);
  padding: 18px;
  text-align:center;
}
.modalTitle{ font-weight: 900; font-size: 40px; }
.stars{ margin-top: 10px; display:flex; align-items:center; justify-content:center; gap: 10px; }
.starText{ color: var(--gold); font-size: 22px; letter-spacing: 1px; }
.starValue{ font-weight: 900; font-size: 16px; }
.rewards{ margin-top: 12px; display:flex; gap: 10px; justify-content:center; }
.rewardPill{ display:flex; align-items:center; gap: 8px; padding: 10px 12px; border-radius: var(--pill); border: 1px solid rgba(0,0,0,0.08); background: rgba(255,255,255,0.75); font-weight: 900; }
body.night .rewardPill{ background: rgba(255,255,255,0.10); border-color: rgba(255,255,255,0.14); }
.modalSub{ margin-top: 12px; color: var(--muted); font-weight: 700; }

.ctaBig{
  margin-top: 14px;
  width: 100%;
  height: 54px;
  border-radius: 18px;
  border: 1px solid rgba(0,0,0,0.08);
  background: linear-gradient(180deg, #ffcf5a, #ffb43b);
  color: #5a3b00;
  font-weight: 900;
  font-size: 16px;
  cursor:pointer;
  box-shadow: 0 16px 24px rgba(255,180,59,0.25);
}

/* Toast */
.toast{
  pointer-events:none;
  position:absolute;
  left: 50%;
  bottom: calc(88px + var(--safeB));
  transform: translateX(-50%);
  padding: 10px 14px;
  border-radius: var(--pill);
  background: rgba(0,0,0,0.72);
  color: white;
  font-weight: 800;
  font-size: 13px;
  z-index: 12;
}
.toast.hidden{ display:none; }

@keyframes fadeInOut {
  0% { opacity: 0; transform: translateX(-50%) translateY(8px); }
  12% { opacity: 1; transform: translateX(-50%) translateY(0); }
  78% { opacity: 1; transform: translateX(-50%) translateY(0); }
  100% { opacity: 0; transform: translateX(-50%) translateY(-6px); }
}

/* Responsive tweaks */
@media (max-width: 900px){
  .topBar{ gap: 8px; }
  .currencyRow{ gap: 6px; }
  .pill{ padding: 7px 9px; }
}

@media (max-width: 640px){
  .topBar{ flex-wrap: wrap; gap: 6px; }
  .challengeCard{ flex: 1 1 calc(100% - 52px); }
  .challengeTitle{ font-size: 16px; }
  .challengeSub{ font-size: 11px; }
  .topRight{ width: 100%; justify-content: flex-end; }
  .currencyRow{ flex-wrap: wrap; justify-content:flex-end; }
  .iconBtn{ width: 40px; height: 40px; }
  .hint{ top: calc(96px + var(--safeT)); }
  .leftPanel{ top: calc(140px + var(--safeT)); width: 140px; }
  .taskLabel{ font-size: 11px; }
  .bottomBar{ left: 10px; right: 10px; }
  .bottomBarBody{ grid-template-columns: 52px minmax(0, 1fr); }
  .categoryTabs{ padding: 6px; }
  .categoryTab{ width: 36px; height: 36px; font-size: 16px; }
  .itemCard{ width: 104px; }
  .itemThumb{ width: 48px; height: 48px; }
  .panelBtn{ height: 32px; padding: 0 10px; }
  .finishBtn{ height: 32px; }
}

@media (max-width: 420px){
  .leftPanel{ width: 132px; }
  .itemCard{ width: 96px; }
  .bottomBar{ padding: 8px 10px 10px; }
  .itemCarousel{ gap: 10px; }
}

@media (min-width: 640px) and (orientation: landscape){
  .bottomBarBody{ grid-template-columns: 1fr; grid-template-rows: auto auto; }
  .categoryTabs{ flex-direction: row; justify-content:flex-start; }
  .categoryTab{ width: 50px; height: 40px; font-size: 18px; }
}

@media (max-height: 520px) and (orientation: landscape){
  .topBar{ top: calc(6px + var(--safeT)); }
  .leftPanel{ top: calc(92px + var(--safeT)); max-height: calc(100% - 180px); }
  .bottomBar{ padding: 8px 10px 10px; }
  .bottomBarBody{ max-height: 30vh; }
  .itemCard{ width: 96px; }
  .itemThumb{ width: 44px; height: 44px; }
}
